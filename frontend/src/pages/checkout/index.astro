---
import CheckoutLayout from "../../layouts/CheckoutLayout.astro";
---

<CheckoutLayout>
    <div id="checkout"></div>
</CheckoutLayout>

<script>
    const backendUrl = import.meta.env.PUBLIC_API_URL;

    import { loadStripe } from "@stripe/stripe-js";
    const stripe = await loadStripe(
        import.meta.env.PUBLIC_STRIPE_PUBLISHABLE_KEY
    );

    initialize();

    // Fetch Checkout Session and retrieve the client secret
    async function initialize() {
        const fetchClientSecret = async () => {
            const response = await fetch(
                `${backendUrl}/create-checkout-session`,
                {
                    method: "POST",
                }
            );
            const { clientSecret } = await response.json();
            return clientSecret;
        };

        // Initialize Checkout
        const checkout = await stripe?.initEmbeddedCheckout({
            fetchClientSecret,
        });

        // Mount Checkout
        checkout?.mount("#checkout");
    }
</script>
